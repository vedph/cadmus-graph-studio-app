<form [formGroup]="form" (submit)="run()">
  <div id="container">
    <div>
      <mat-progress-bar *ngIf="busy" mode="indeterminate"></mat-progress-bar>
    </div>
    <!-- input -->
    <div id="input">
      <div>
        <mat-label>input</mat-label>
        <!-- TODO : add [model]="editorModel" to enable syntax hilite -->
        <ngx-monaco-editor
          class="monaco"
          [options]="editorOptions"
          [formControl]="input"
        ></ngx-monaco-editor>
        <mat-error
          *ngIf="$any(input).errors?.required && (input.dirty || input.touched)"
          >input required</mat-error
        >
        <mat-error
          *ngIf="
            $any(input).errors?.maxLength && (input.dirty || input.touched)
          "
          >input too long</mat-error
        >
      </div>
      <fieldset>
        <legend>presets</legend>
        <cadmus-cached-text-picker
          [text]="input.value"
          keyPrefix="map_"
          (textPick)="onTextPick($event)"
        ></cadmus-cached-text-picker>
      </fieldset>

      <div>
        <button type="submit" color="primary" mat-flat-button>
          <mat-icon>play_circle</mat-icon>
          run
        </button>
      </div>
      <br />
      <p *ngIf="error" class="error">{{ error }}</p>
    </div>
    <!-- output -->
    <div id="output" *ngIf="graphSet">
      <!-- nodes -->
      <mat-expansion-panel [expanded]="graphSet.nodes.length">
        <mat-expansion-panel-header>
          <mat-panel-title> nodes </mat-panel-title>
          <mat-panel-description>
            {{ graphSet.nodes.length }}
          </mat-panel-description>
        </mat-expansion-panel-header>
        <table>
          <thead>
            <th>label</th>
            <th>uri</th>
            <th>sid</th>
          </thead>
          <tbody>
            <tr *ngFor="let n of graphSet.nodes">
              <td>{{ n.label }}</td>
              <td class="uri">{{ n.uri }}</td>
              <td>{{ n.sid }}</td>
            </tr>
          </tbody>
        </table>
      </mat-expansion-panel>
      <!-- triples -->
      <mat-expansion-panel [expanded]="graphSet.triples.length">
        <mat-expansion-panel-header>
          <mat-panel-title> triples </mat-panel-title>
          <mat-panel-description>
            {{ graphSet.triples.length }}
          </mat-panel-description>
        </mat-expansion-panel-header>
        <table>
          <thead>
            <th>S</th>
            <th>P</th>
            <th>O</th>
            <th>sid</th>
          </thead>
          <tbody>
            <tr *ngFor="let t of graphSet.triples">
              <td class="uri">{{ t.subjectUri }}</td>
              <td class="tp">{{ t.predicateUri }}</td>
              <td class="to">{{ t.objectUri || t.objectLiteral }}</td>
              <td>{{ t.sid }}</td>
            </tr>
          </tbody>
        </table>
      </mat-expansion-panel>
    </div>
  </div>
</form>
